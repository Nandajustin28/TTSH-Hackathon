{% extends 'base.html' %}

{% block title %}Settings - MediFlow{% endblock %}

{% block content %}
<div class="dashboard-content">
    <!-- Header Section -->
    <div class="dashboard-header">
        <h1>Settings</h1>
        <p>Manage your account preferences</p>
    </div>

    <!-- Settings Form -->
    <form method="POST" class="settings-form">
        {% csrf_token %}
        
        <!-- Profile Information Section -->
        <div class="settings-card">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-user"></i>
                </div>
                <h2>Profile Information</h2>
            </div>
            
            <div class="form-section">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        value="{{ user_email }}" 
                        readonly
                        class="form-input readonly"
                    >
                    <small class="form-help">Email cannot be changed</small>
                </div>

                <div class="form-group">
                    <label for="full_name">Full Name</label>
                    <input 
                        type="text" 
                        id="full_name" 
                        name="full_name" 
                        value="{{ user_full_name }}" 
                        class="form-input"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="username">Username</label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        value="{{ user_username }}" 
                        placeholder="Enter your username"
                        class="form-input"
                    >
                </div>

                <div class="form-group">
                    <label for="role">Role</label>
                    <input 
                        type="text" 
                        id="role" 
                        name="role" 
                        value="{{ user_role }}" 
                        readonly
                        class="form-input readonly"
                    >
                </div>
            </div>
        </div>

        <!-- Notification Preferences Section -->
        <div class="settings-card">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-bell"></i>
                </div>
                <h2>Notification Preferences</h2>
            </div>
            
            <div class="form-section">
                <div class="notification-item">
                    <div class="notification-content">
                        <h3>Email Notifications</h3>
                        <p>Receive email notifications for important updates</p>
                    </div>
                    <div class="toggle-switch">
                        <input 
                            type="checkbox" 
                            id="email_notifications" 
                            name="email_notifications" 
                            {% if email_notifications_enabled %}checked{% endif %}
                        >
                        <label for="email_notifications" class="switch-label">
                            <span class="switch-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="notification-item">
                    <div class="notification-content">
                        <h3>New Referrals</h3>
                        <p>Get notified when AI defers a case to doctors</p>
                    </div>
                    <div class="toggle-switch">
                        <input 
                            type="checkbox" 
                            id="new_referrals" 
                            name="new_referrals" 
                            {% if new_referrals_enabled %}checked{% endif %}
                        >
                        <label for="new_referrals" class="switch-label">
                            <span class="switch-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Privacy Settings Section -->
        <div class="settings-card">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h2>Privacy & Data Usage</h2>
            </div>
            
            <div class="form-section">
                <div class="notification-item">
                    <div class="notification-content">
                        <h3>Patient Data Analytics</h3>
                        <p>Allow anonymized patient data to be used for improving AI models and healthcare analytics</p>
                    </div>
                    <div class="toggle-switch">
                        <input 
                            type="checkbox" 
                            id="data_analytics" 
                            name="data_analytics" 
                            {% if data_analytics_enabled %}checked{% endif %}
                        >
                        <label for="data_analytics" class="switch-label">
                            <span class="switch-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="notification-item">
                    <div class="notification-content">
                        <h3>Research Participation</h3>
                        <p>Share de-identified patient data for medical research and clinical studies</p>
                    </div>
                    <div class="toggle-switch">
                        <input 
                            type="checkbox" 
                            id="research_participation" 
                            name="research_participation" 
                            {% if research_participation_enabled %}checked{% endif %}
                        >
                        <label for="research_participation" class="switch-label">
                            <span class="switch-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="notification-item">
                    <div class="notification-content">
                        <h3>Data Retention</h3>
                        <p>Automatically delete patient forms and associated data after specified period</p>
                    </div>
                    <div class="toggle-switch">
                        <input 
                            type="checkbox" 
                            id="auto_data_deletion" 
                            name="auto_data_deletion" 
                            {% if auto_data_deletion_enabled %}checked{% endif %}
                        >
                        <label for="auto_data_deletion" class="switch-label">
                            <span class="switch-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="data_retention_period">Data Retention Period</label>
                    <select 
                        id="data_retention_period" 
                        name="data_retention_period" 
                        class="form-input"
                    >
                        <option value="1" {% if data_retention_period == "1" %}selected{% endif %}>1 Year</option>
                        <option value="2" {% if data_retention_period == "2" %}selected{% endif %}>2 Years</option>
                        <option value="5" {% if data_retention_period == "5" %}selected{% endif %}>5 Years</option>
                        <option value="7" {% if data_retention_period == "7" %}selected{% endif %}>7 Years (Legal Requirement)</option>
                        <option value="10" {% if data_retention_period == "10" %}selected{% endif %}>10 Years</option>
                        <option value="permanent" {% if data_retention_period == "permanent" %}selected{% endif %}>Permanent</option>
                    </select>
                    <small class="form-help">Choose how long patient data should be retained in the system</small>
                </div>

                <div class="notification-item">
                    <div class="notification-content">
                        <h3>Third-Party Integrations</h3>
                        <p>Allow secure sharing of patient data with approved healthcare partners and systems</p>
                    </div>
                    <div class="toggle-switch">
                        <input 
                            type="checkbox" 
                            id="third_party_sharing" 
                            name="third_party_sharing" 
                            {% if third_party_sharing_enabled %}checked{% endif %}
                        >
                        <label for="third_party_sharing" class="switch-label">
                            <span class="switch-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Display Settings Section -->
        <div class="settings-card">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-desktop"></i>
                </div>
                <h2>Display Settings</h2>
            </div>
            
            <div class="form-section">
                <!-- Theme Selection -->
                <div class="form-group">
                    <label for="theme_mode">Theme Mode</label>
                    <div class="theme-selector">
                        <div class="theme-option">
                            <input 
                                type="radio" 
                                id="light_mode" 
                                name="theme_mode" 
                                value="light" 
                                {% if theme_mode == "light" %}checked{% endif %}
                            >
                            <label for="light_mode" class="theme-label">
                                <div class="theme-preview light-preview">
                                    <div class="preview-header"></div>
                                    <div class="preview-content"></div>
                                </div>
                                <span class="theme-name">
                                    <i class="fas fa-sun"></i>
                                    Light Mode
                                </span>
                            </label>
                        </div>
                        
                        <div class="theme-option">
                            <input 
                                type="radio" 
                                id="dark_mode" 
                                name="theme_mode" 
                                value="dark" 
                                {% if theme_mode == "dark" %}checked{% endif %}
                            >
                            <label for="dark_mode" class="theme-label">
                                <div class="theme-preview dark-preview">
                                    <div class="preview-header"></div>
                                    <div class="preview-content"></div>
                                </div>
                                <span class="theme-name">
                                    <i class="fas fa-moon"></i>
                                    Dark Mode
                                </span>
                            </label>
                        </div>
                        
                        <div class="theme-option">
                            <input 
                                type="radio" 
                                id="auto_mode" 
                                name="theme_mode" 
                                value="auto" 
                                {% if theme_mode == "auto" %}checked{% endif %}
                            >
                            <label for="auto_mode" class="theme-label">
                                <div class="theme-preview auto-preview">
                                    <div class="preview-header"></div>
                                    <div class="preview-content"></div>
                                </div>
                                <span class="theme-name">
                                    <i class="fas fa-adjust"></i>
                                    Auto
                                </span>
                            </label>
                        </div>
                    </div>
                    <small class="form-help">Choose your preferred theme. Auto mode follows your system preference.</small>
                </div>

                <!-- Font Size -->
                <div class="form-group">
                    <label for="font_size">Font Size</label>
                    <div class="font-size-container">
                        <input 
                            type="range" 
                            id="font_size" 
                            name="font_size" 
                            min="12" 
                            max="20" 
                            value="{{ font_size|default:'14' }}" 
                            class="font-size-slider"
                        >
                        <div class="font-size-display">
                            <span id="font_size_value">{{ font_size|default:'14' }}px</span>
                            <div class="font-preview" id="font_preview">Sample Text</div>
                        </div>
                    </div>
                    <small class="form-help">Adjust the font size for better readability</small>
                </div>

                <!-- Layout Options -->
                <div class="form-group">
                    <label>Patient Data Layout</label>
                    <div class="layout-selector">
                        <div class="layout-option">
                            <input 
                                type="radio" 
                                id="layout_table" 
                                name="data_layout" 
                                value="table" 
                                {% if data_layout == "table" %}checked{% endif %}
                            >
                            <label for="layout_table" class="layout-label">
                                <div class="layout-preview table-preview">
                                    <div class="preview-row"></div>
                                    <div class="preview-row"></div>
                                    <div class="preview-row"></div>
                                </div>
                                <span class="layout-name">
                                    <i class="fas fa-table"></i>
                                    Table View
                                </span>
                            </label>
                        </div>
                        
                        <div class="layout-option">
                            <input 
                                type="radio" 
                                id="layout_cards" 
                                name="data_layout" 
                                value="cards" 
                                {% if data_layout == "cards" %}checked{% endif %}
                            >
                            <label for="layout_cards" class="layout-label">
                                <div class="layout-preview cards-preview">
                                    <div class="preview-card"></div>
                                    <div class="preview-card"></div>
                                    <div class="preview-card"></div>
                                </div>
                                <span class="layout-name">
                                    <i class="fas fa-th-large"></i>
                                    Card View
                                </span>
                            </label>
                        </div>
                        
                        <div class="layout-option">
                            <input 
                                type="radio" 
                                id="layout_list" 
                                name="data_layout" 
                                value="list" 
                                {% if data_layout == "list" %}checked{% endif %}
                            >
                            <label for="layout_list" class="layout-label">
                                <div class="layout-preview list-preview">
                                    <div class="preview-item"></div>
                                    <div class="preview-item"></div>
                                    <div class="preview-item"></div>
                                </div>
                                <span class="layout-name">
                                    <i class="fas fa-list"></i>
                                    List View
                                </span>
                            </label>
                        </div>
                    </div>
                    <small class="form-help">Choose how patient data is displayed in the database</small>
                </div>

                <!-- Display Options -->
                <div class="notification-item">
                    <div class="notification-content">
                        <h3>Compact Mode</h3>
                        <p>Use smaller spacing and condensed layout to show more information</p>
                    </div>
                    <div class="toggle-switch">
                        <input 
                            type="checkbox" 
                            id="compact_mode" 
                            name="compact_mode" 
                            {% if compact_mode_enabled %}checked{% endif %}
                        >
                        <label for="compact_mode" class="switch-label">
                            <span class="switch-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="notification-item">
                    <div class="notification-content">
                        <h3>Show Timestamps</h3>
                        <p>Display detailed timestamps for all actions and uploads</p>
                    </div>
                    <div class="toggle-switch">
                        <input 
                            type="checkbox" 
                            id="show_timestamps" 
                            name="show_timestamps" 
                            {% if show_timestamps_enabled %}checked{% endif %}
                        >
                        <label for="show_timestamps" class="switch-label">
                            <span class="switch-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="notification-item">
                    <div class="notification-content">
                        <h3>Animated Transitions</h3>
                        <p>Enable smooth animations and transitions throughout the interface</p>
                    </div>
                    <div class="toggle-switch">
                        <input 
                            type="checkbox" 
                            id="animations_enabled" 
                            name="animations_enabled" 
                            {% if animations_enabled %}checked{% endif %}
                        >
                        <label for="animations_enabled" class="switch-label">
                            <span class="switch-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Items Per Page -->
                <div class="form-group">
                    <label for="items_per_page">Items Per Page</label>
                    <select 
                        id="items_per_page" 
                        name="items_per_page" 
                        class="form-input"
                    >
                        <option value="10" {% if items_per_page == "10" %}selected{% endif %}>10 items</option>
                        <option value="25" {% if items_per_page == "25" %}selected{% endif %}>25 items</option>
                        <option value="50" {% if items_per_page == "50" %}selected{% endif %}>50 items</option>
                        <option value="100" {% if items_per_page == "100" %}selected{% endif %}>100 items</option>
                    </select>
                    <small class="form-help">Number of patient records to display per page</small>
                </div>
            </div>
        </div>

        <!-- Save Button -->
        <div class="form-actions">
            <button type="submit" class="save-button">
                <i class="fas fa-save"></i>
                Save Settings
            </button>
        </div>
    </form>

    <!-- Display Messages -->
    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="message message-{{ message.tags }}">
                    <i class="fas fa-check-circle"></i>
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>

<style>
/* Settings Page Styles */
.settings-container {
    padding: 2rem;
    max-width: 800px;
    margin: 0 auto;
}

.page-header {
    margin-bottom: 2rem;
}

.page-header h1 {
    font-size: 2rem;
    font-weight: 600;
    color: #1a1a1a;
    margin: 0 0 0.5rem 0;
}

.page-description {
    color: #666;
    font-size: 1rem;
    margin: 0;
}

/* Settings Form */
.settings-form {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

/* Settings Cards */
.settings-card {
    background: var(--card-bg);
    border-radius: 12px;
    box-shadow: var(--shadow-light);
    overflow: hidden;
    border: 1px solid var(--border-primary);
    transition: background-color 0.3s ease, border-color 0.3s ease;
}

.card-header {
    background: var(--bg-tertiary);
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-primary);
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: background-color 0.3s ease, border-color 0.3s ease;
}

.card-icon {
    width: 40px;
    height: 40px;
    background: var(--primary-color);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.1rem;
}

.card-header h2 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
    transition: color 0.3s ease;
}

.form-section {
    padding: 2rem;
    background: var(--card-bg);
    transition: background-color 0.3s ease;
}

/* Form Groups */
.form-group {
    margin-bottom: 1.5rem;
}

.form-group:last-child {
    margin-bottom: 0;
}

.form-group label {
    display: block;
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    transition: color 0.3s ease;
}

.form-input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid var(--border-primary);
    border-radius: 8px;
    font-size: 0.95rem;
    transition: border-color 0.2s, box-shadow 0.2s, background-color 0.3s ease, color 0.3s ease;
    background: var(--input-bg);
    color: var(--text-primary);
}

.form-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

.form-input.readonly {
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    cursor: not-allowed;
}

/* Select dropdown styling */
select.form-input {
    cursor: pointer;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 0.5rem center;
    background-repeat: no-repeat;
    background-size: 1.5em 1.5em;
    padding-right: 2.5rem;
    appearance: none;
}

select.form-input:focus {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%234f46e5' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
}

/* Theme Selector Styles */
.theme-selector {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
    margin-top: 0.5rem;
}

.theme-option {
    position: relative;
}

.theme-option input[type="radio"] {
    display: none;
}

.theme-label {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    background: white;
}

.theme-label:hover {
    border-color: #4f46e5;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.15);
}

.theme-option input[type="radio"]:checked + .theme-label {
    border-color: #4f46e5;
    background: #f8fafc;
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.15);
}

.theme-preview {
    width: 60px;
    height: 40px;
    border-radius: 6px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.light-preview {
    background: #ffffff;
}

.light-preview .preview-header {
    height: 12px;
    background: #f8fafc;
    border-bottom: 1px solid #e1e5e9;
}

.light-preview .preview-content {
    height: 27px;
    background: #ffffff;
}

.dark-preview {
    background: #1f2937;
}

.dark-preview .preview-header {
    height: 12px;
    background: #374151;
    border-bottom: 1px solid #4b5563;
}

.dark-preview .preview-content {
    height: 27px;
    background: #1f2937;
}

.auto-preview {
    background: linear-gradient(45deg, #ffffff 50%, #1f2937 50%);
}

.auto-preview .preview-header {
    height: 12px;
    background: linear-gradient(45deg, #f8fafc 50%, #374151 50%);
}

.auto-preview .preview-content {
    height: 27px;
    background: linear-gradient(45deg, #ffffff 50%, #1f2937 50%);
}

.theme-name {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    font-weight: 500;
    color: #374151;
}

/* Font Size Slider */
.font-size-container {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-top: 0.5rem;
}

.font-size-slider {
    flex: 1;
    height: 6px;
    border-radius: 3px;
    background: var(--border-primary);
    outline: none;
    appearance: none;
}

.font-size-slider::-webkit-slider-thumb {
    appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--primary-color);
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.font-size-slider::-moz-range-thumb {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--primary-color);
    cursor: pointer;
    border: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.font-size-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    min-width: 100px;
}

#font_size_value {
    font-weight: 600;
    color: var(--primary-color);
    font-size: 0.9rem;
}

.font-preview {
    padding: 0.5rem;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 4px;
    text-align: center;
    color: var(--text-primary);
    font-size: 14px;
    transition: font-size 0.2s;
}

/* Layout Selector */
.layout-selector {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 1rem;
    margin-top: 0.5rem;
}

.layout-option {
    position: relative;
}

.layout-option input[type="radio"] {
    display: none;
}

.layout-label {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    background: white;
}

.layout-label:hover {
    border-color: #4f46e5;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.15);
}

.layout-option input[type="radio"]:checked + .layout-label {
    border-color: #4f46e5;
    background: #f8fafc;
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.15);
}

.layout-preview {
    width: 50px;
    height: 35px;
    border-radius: 4px;
    padding: 4px;
    background: #f8fafc;
    border: 1px solid #e1e5e9;
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.table-preview .preview-row {
    height: 6px;
    background: #cbd5e1;
    border-radius: 1px;
}

.cards-preview {
    flex-direction: row;
    flex-wrap: wrap;
    gap: 3px;
}

.cards-preview .preview-card {
    width: 14px;
    height: 12px;
    background: #cbd5e1;
    border-radius: 2px;
}

.list-preview .preview-item {
    height: 8px;
    background: #cbd5e1;
    border-radius: 1px;
    margin-bottom: 1px;
}

.layout-name {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    font-weight: 500;
    color: #374151;
}

.form-help {
    display: block;
    font-size: 0.8rem;
    color: #6b7280;
    margin-top: 0.25rem;
}

/* Notification Items */
.notification-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 0;
    border-bottom: 1px solid var(--border-light);
    transition: border-color 0.3s ease;
}

.notification-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.notification-item:first-child {
    padding-top: 0;
}

.notification-content h3 {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 0.25rem 0;
    transition: color 0.3s ease;
}

.notification-content p {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin: 0;
    line-height: 1.4;
    transition: color 0.3s ease;
}

/* Toggle Switch */
.toggle-switch {
    position: relative;
}

.toggle-switch input[type="checkbox"] {
    display: none;
}

.switch-label {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 28px;
    cursor: pointer;
}

.switch-slider {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: #cbd5e1;
    border-radius: 28px;
    transition: background-color 0.3s;
}

.switch-slider:before {
    content: '';
    position: absolute;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: white;
    top: 3px;
    left: 3px;
    transition: transform 0.3s;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.toggle-switch input[type="checkbox"]:checked + .switch-label .switch-slider {
    background: #4f46e5;
}

.toggle-switch input[type="checkbox"]:checked + .switch-label .switch-slider:before {
    transform: translateX(22px);
}

/* Form Actions */
.form-actions {
    display: flex;
    justify-content: flex-end;
    padding-top: 1rem;
}

.save-button {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem 2rem;
    background: #4f46e5;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 0.95rem;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.1s;
}

.save-button:hover {
    background: #4338ca;
    transform: translateY(-1px);
}

.save-button:active {
    transform: translateY(0);
}

/* Messages */
.messages {
    position: fixed;
    top: 2rem;
    right: 2rem;
    z-index: 1000;
}

.message {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 1.5rem;
    background: #ecfdf5;
    color: #065f46;
    border: 1px solid #a7f3d0;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    margin-bottom: 0.5rem;
    animation: slideInRight 0.3s ease;
}

.message.message-success {
    background: #ecfdf5;
    color: #065f46;
    border-color: #a7f3d0;
}

.message.message-error {
    background: #fef2f2;
    color: #991b1b;
    border-color: #fca5a5;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .settings-container {
        padding: 1rem;
    }
    
    .card-header {
        padding: 1rem;
    }
    
    .form-section {
        padding: 1.5rem;
    }
    
    .notification-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .theme-selector {
        grid-template-columns: 1fr;
        gap: 0.75rem;
    }
    
    .layout-selector {
        grid-template-columns: 1fr;
        gap: 0.75rem;
    }
    
    .font-size-container {
        flex-direction: column;
        align-items: stretch;
        gap: 1rem;
    }
    
    .font-size-display {
        flex-direction: row;
        justify-content: space-between;
        min-width: auto;
    }
    
    .messages {
        top: 1rem;
        right: 1rem;
        left: 1rem;
    }
    
    .form-actions {
        justify-content: stretch;
    }
    
    .save-button {
        width: 100%;
        justify-content: center;
    }
}

/* Auto-hide messages */
.message {
    animation: slideInRight 0.3s ease, fadeOut 0.3s ease 4s forwards;
}

@keyframes fadeOut {
    to {
        opacity: 0;
        transform: translateX(100%);
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-hide messages after 5 seconds
    const messages = document.querySelectorAll('.message');
    messages.forEach(message => {
        setTimeout(() => {
            message.style.animation = 'fadeOut 0.3s ease forwards';
            setTimeout(() => {
                message.remove();
            }, 300);
        }, 5000);
    });
    
    // Font size slider functionality
    const fontSizeSlider = document.getElementById('font_size');
    const fontSizeValue = document.getElementById('font_size_value');
    const fontPreview = document.getElementById('font_preview');
    
    if (fontSizeSlider && fontSizeValue && fontPreview) {
        fontSizeSlider.addEventListener('input', function() {
            const size = this.value;
            fontSizeValue.textContent = size + 'px';
            fontPreview.style.fontSize = size + 'px';
        });
    }
    
    // Theme selection preview and integration with global theme manager
    const themeInputs = document.querySelectorAll('input[name="theme_mode"]');
    
    // Set initial state based on current theme
    const currentTheme = localStorage.getItem('theme_preference') || 'light';
    themeInputs.forEach(input => {
        if (input.value === currentTheme) {
            input.checked = true;
        }
    });
    
    themeInputs.forEach(input => {
        input.addEventListener('change', function() {
            // Visual feedback
            const allLabels = document.querySelectorAll('.theme-label');
            allLabels.forEach(label => label.style.transform = 'translateY(0)');
            
            if (this.checked) {
                this.nextElementSibling.style.transform = 'translateY(-2px)';
                
                // Apply theme immediately via global theme manager
                if (window.themeManager) {
                    localStorage.setItem('theme_preference', this.value);
                    window.themeManager.setTheme(this.value);
                }
            }
        });
    });
    
    // Layout selection preview
    const layoutInputs = document.querySelectorAll('input[name="data_layout"]');
    layoutInputs.forEach(input => {
        input.addEventListener('change', function() {
            const allLabels = document.querySelectorAll('.layout-label');
            allLabels.forEach(label => label.style.transform = 'translateY(0)');
            
            if (this.checked) {
                this.nextElementSibling.style.transform = 'translateY(-2px)';
            }
        });
    });
    
    // Live preview for display settings
    const compactModeToggle = document.getElementById('compact_mode');
    const animationsToggle = document.getElementById('animations_enabled');
    
    if (compactModeToggle) {
        compactModeToggle.addEventListener('change', function() {
            // Add visual feedback for compact mode
            const settingsContainer = document.querySelector('.settings-container');
            if (this.checked) {
                settingsContainer.style.fontSize = '0.9em';
                settingsContainer.style.transition = 'font-size 0.3s ease';
            } else {
                settingsContainer.style.fontSize = '1em';
            }
        });
    }
    
    if (animationsToggle) {
        animationsToggle.addEventListener('change', function() {
            // Toggle animations globally
            if (this.checked) {
                document.body.style.setProperty('--animation-duration', '0.3s');
            } else {
                document.body.style.setProperty('--animation-duration', '0s');
            }
        });
    }
    
    // Add form validation
    const form = document.querySelector('.settings-form');
    form.addEventListener('submit', function(e) {
        const fullName = document.getElementById('full_name').value.trim();
        
        if (!fullName) {
            e.preventDefault();
            alert('Full name is required.');
            document.getElementById('full_name').focus();
            return;
        }
        
        // Show success feedback
        const saveButton = document.querySelector('.save-button');
        const originalText = saveButton.innerHTML;
        saveButton.innerHTML = '<i class="fas fa-check"></i> Saved!';
        saveButton.style.background = '#10b981';
        
        setTimeout(() => {
            saveButton.innerHTML = originalText;
            saveButton.style.background = '#4f46e5';
        }, 2000);
    });
});
</script>
{% endblock %}